<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Websocket C# Test</title>
</head>
<body>
    <p id="OVR"></p>
    <p id="controllerType"></p>
    <br>
    <p id="leftThumb"></p>
    <p id="rightThumb"></p>
    

    <script>
        const socket = new WebSocket('ws://localhost:8080', "rosc.frontend");
        const OVR = document.getElementById("OVR");
        const ctrlType = document.getElementById("controllerType");
        const leftThumb = document.getElementById("leftThumb");
        const rightThumb = document.getElementById("rightThumb");

        // Connection opened
        socket.addEventListener('open', function (event) {
            const identifier = {
                type: "identifier",
                name: "frontend"
            }
            socket.send(JSON.stringify(identifier));
        });

        // Listen for messages
        socket.addEventListener('message', function (event) {
            const data = event.data;
            
            if ( !isJsonString(data) ) return;
            const {type, payload} = JSON.parse(data);

            OVR.innerText = `Connected to OVR: ${payload.connectedToOVR}`;
            ctrlType.innerText = `Controller Type: ${payload.isIndex ? "Index Knuckles": "Quest 2"}`;
            leftThumb.innerText = `Left Thumb: ${payload.leftThumb}`;
            rightThumb.innerText = `Right Thumb: ${payload.rightThumb}`;
        });

        function isJsonString( str ) {
            try {
                JSON.parse( str );
            } catch ( e ) {
                return false;
            }
            return true;
        }
    </script>
</body>
</html>